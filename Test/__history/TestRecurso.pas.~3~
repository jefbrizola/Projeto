unit TestRecurso;
{

  Delphi DUnit Test Case
  ----------------------
  This unit contains a skeleton test case class generated by the Test Case Wizard.
  Modify the generated code to correctly setup and call the methods from the unit 
  being tested.

}

interface

uses
  TestFramework, Recurso, Datasnap.DBClient, system.classes, Data.DB,
  System.Math;

type
  // Test methods for class TCalcula

  TestTCalcula = class(TTestCase)
  strict private
    FCalcula: TCalcula;
  public
    procedure SetUp; override;
    procedure TearDown; override;

  published
    procedure Testcalculo;
    procedure TestcalculoTotDiv;
  end;

implementation

procedure TestTCalcula.SetUp;
begin
  FCalcula := TCalcula.Create;
end;

procedure TestTCalcula.TearDown;
begin
  FCalcula.Free;
  FCalcula := nil;
end;

procedure TestTCalcula.Testcalculo;
var
  ReturnValue: Double;
  pCDS: TClientDataSet;
   i: integer;
begin
  // TODO: Setup method call parameters

  pCDS:= TClientDataSet.Create(nil);
  pCDS.Close;
  pCDS.FieldDefs.Clear;
  pCDS.FieldDefs.add('Valor',ftCurrency);
  pCDS.CreateDataSet;
  pCDS.Open;

  for i := 1 to 10 do
  begin
     pCDS.Insert;
     pCDS.FieldByName('Valor').AsCurrency:= i;
  end;

  ReturnValue := FCalcula.calculo(pCDS);
  CheckEquals(55,ReturnValue,'OCORREU ERRO!');

  // TODO: Validate method results
end;

procedure TestTCalcula.TestcalculoTotDiv;
var
  ReturnValue: Double;
  pCDS: TClientDataSet;
   i: integer;
begin

  pCDS:= TClientDataSet.Create(nil);
  pCDS.Close;
  pCDS.FieldDefs.Clear;
  pCDS.FieldDefs.add('Valor',ftCurrency);
  pCDS.CreateDataSet;
  pCDS.Open;

   pCDS.Insert;
   pCDS.FieldByName('Valor').AsCurrency:= 10;
   pCDS.FieldByName('Valor').AsCurrency:= 20;
   pCDS.FieldByName('Valor').AsCurrency:= 30;

  ReturnValue := FCalcula.calculoTotDiv(pCDS);

  CheckEquals(3.5,ReturnValue,'OCORREU ERRO!');

end;

initialization
  // Register any test cases with the test runner
  RegisterTest(TestTCalcula.Suite);
end.

